<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Ajouter un lieu</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</h:head>

<h:body class="min-h-screen bg-gray-50 flex flex-col items-center py-10 px-4 space-y-8">

    <!-- En-tête simple -->
    <div class="w-full max-w-5xl flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-extrabold text-gray-900">Gestion des Lieux</h1>
            <p class="text-gray-500 text-sm">Organisez vos destinations en Indonésie</p>
        </div>
        <h:form>
            <h:commandLink action="#{navigationController.home}"
                styleClass="bg-white border border-gray-200 text-gray-700 px-6 py-3 rounded-2xl font-bold hover:bg-gray-50 transition shadow-sm flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-600" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Retour
            </h:commandLink>
        </h:form>
    </div>

    <!-- Section Météo (Concentrée) -->
    <div
        class="w-full max-w-5xl bg-white p-8 rounded-3xl shadow-lg border border-gray-100 flex flex-col md:flex-row items-center gap-8">
        <div class="flex-1 space-y-4">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                <span class="p-2 bg-blue-50 rounded-lg">☁️</span>
                Météo en Direct
            </h2>
            <h:form class="flex flex-col sm:flex-row gap-4">
                <h:selectOneMenu value="#{lieuBean.selectedLieu}"
                    styleClass="flex-1 bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-gray-700 outline-none focus:ring-2 focus:ring-blue-400">
                    <f:selectItems value="#{lieuBean.listeLieux}" var="lieu" itemValue="#{lieu.id}"
                        itemLabel="#{lieu.nom}" />
                    <f:ajax listener="#{lieuBean.updateWeatherMessage}" render="weatherText" />
                </h:selectOneMenu>
                <h:commandLink action="#{visiteBean.afficherFormulaireVisite}"
                    styleClass="bg-gray-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-black transition text-center">
                    Planifier une visite
                </h:commandLink>
            </h:form>
        </div>
        <div id="weatherDisplay"
            class="w-full md:w-64 h-24 bg-blue-600 rounded-2xl flex items-center justify-center p-4 text-center">
            <h:outputText id="weatherText" value="#{lieuBean.weatherMessage}"
                styleClass="text-white font-semibold italic text-sm" />
        </div>
    </div>

    <!-- Section Ajout & Table (Principale) -->
    <div class="w-full max-w-5xl bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden">

        <!-- Formulaire d'ajout -->
        <div class="p-8 md:p-10 border-b border-gray-100">
            <h2 class="text-2xl font-bold text-gray-900 mb-8">Ajouter une Destination</h2>
            <h:form id="formLieu" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="md:col-span-2 space-y-1">
                    <h:outputLabel value="Nom de l'endroit" class="text-xs font-bold text-gray-400 uppercase ml-1" />
                    <h:inputText value="#{LieuBean.nom}" required="true"
                        class="w-full rounded-2xl border border-gray-200 py-3 px-5 focus:border-red-500 focus:ring-4 focus:ring-red-100 outline-none transition" />
                </div>
                <div class="md:col-span-2 space-y-1">
                    <h:outputLabel value="Description / Histoire"
                        class="text-xs font-bold text-gray-400 uppercase ml-1" />
                    <h:inputTextarea value="#{LieuBean.description}" required="true"
                        class="w-full rounded-2xl border border-gray-200 py-3 px-5 h-24 focus:border-red-500 focus:ring-4 focus:ring-red-100 outline-none transition resize-none" />
                </div>
                <div class="space-y-1">
                    <h:outputLabel value="Latitude" class="text-xs font-bold text-gray-400 uppercase ml-1" />
                    <h:inputText value="#{LieuBean.latitude}" required="true"
                        class="w-full rounded-2xl border border-gray-200 py-3 px-5 focus:border-red-500 focus:ring-4 focus:ring-red-100 outline-none transition" />
                </div>
                <div class="space-y-1">
                    <h:outputLabel value="Longitude" class="text-xs font-bold text-gray-400 uppercase ml-1" />
                    <h:inputText value="#{LieuBean.longitude}" required="true"
                        class="w-full rounded-2xl border border-gray-200 py-3 px-5 focus:border-red-500 focus:ring-4 focus:ring-red-100 outline-none transition" />
                </div>
                <div class="md:col-span-2 pt-4">
                    <h:commandButton value="Enregistrer la Destination" action="#{LieuBean.ajouterLieu}"
                        styleClass="w-full bg-red-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-red-100 hover:bg-red-700 transition active:scale-[0.98]" />
                </div>
            </h:form>
        </div>

        <!-- Table des résultats -->
        <div class="p-0 overflow-x-auto">
            <h:dataTable value="#{LieuBean.lieux}" var="l" styleClass="w-full text-left"
                headerClass="bg-gray-50 border-b border-gray-100 p-6 text-xs font-bold text-gray-400 uppercase tracking-widest text-center"
                columnClasses="p-6 border-b border-gray-50 text-center, p-6 border-b border-gray-50, p-6 border-b border-gray-50 text-center, p-6 border-b border-gray-50 text-center">

                <h:column>
                    <f:facet name="header">Destinations</f:facet>
                    <div class="text-left">
                        <p class="font-bold text-gray-900">#{l.nom}</p>
                        <p class="text-xs text-gray-400 mt-1 line-clamp-1">#{l.description}</p>
                    </div>
                </h:column>

                <h:column>
                    <f:facet name="header">Coordonnées</f:facet>
                    <span class="text-xs font-mono text-gray-500 bg-gray-100 px-2 py-1 rounded">#{l.latitude},
                        #{l.longitude}</span>
                </h:column>

                <h:column>
                    <f:facet name="header">Actions</f:facet>
                    <div class="flex justify-center gap-3">
                        <h:form>
                            <h:commandLink action="#{LieuBean.preparerModification(l)}"
                                styleClass="text-blue-600 hover:text-blue-800 font-bold text-sm">Modifier
                            </h:commandLink>
                        </h:form>
                        <h:form>
                            <h:commandLink action="#{LieuBean.supprimerLieu(l.id)}"
                                onclick="return confirm('Supprimer ?');"
                                styleClass="text-red-600 hover:text-red-800 font-bold text-sm">Supprimer</h:commandLink>
                        </h:form>
                    </div>
                </h:column>
            </h:dataTable>
        </div>
    </div>

</h:body>

</html>